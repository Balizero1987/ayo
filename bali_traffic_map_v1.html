<!DOCTYPE html>
<html>
<head>
    <title>Bali Traffic Map - New Regulations 2025</title>
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #legend {
            font-family: Arial, sans-serif;
            background: #fff;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 5;
            border-radius: 5px;
        }
        .legend-item {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        .symbol {
            width: 20px;
            height: 5px;
            margin-right: 10px;
        }
    </style>
    <!-- Load Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIza_REDACTED&callback=initMap" async defer></script>
    <script>
        function initMap() {
            // Center map on Kerobokan Area
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: { lat: -8.6781, lng: 115.166 }, 
                mapTypeId: 'roadmap',
                styles: [
                    {
                        "featureType": "poi",
                        "elementType": "labels",
                        "stylers": [{ "visibility": "off" }] // Reduce clutter
                    }
                ]
            });

            const directionsService = new google.maps.DirectionsService();

            // Segment 1: Jalan Gunung Tangkuban Perahu (BLUE - One Way East -> West)
            calculateAndDisplayRoute(directionsService, map, 
                "Simpang Pengubengan Kangin, Kerobokan Kelod, Bali", 
                "Lembaga Pemasyarakatan Kerobokan, Jalan Tangkuban Perahu, Bali",
                "#0000FF", // BLUE
                "One Way"
            );

            // Segment 2: Simpang Pengubengan Kauh (GREEN - Left Turn Only from Intan Permai)
            calculateAndDisplayRoute(directionsService, map,
                "Jalan Intan Permai, Kerobokan Kelod, Bali", 
                "Indomaret Raya Pengubengan, Kerobokan Kelod, Bali", 
                "#008000", // GREEN
                "Left Turn Only (Intan Permai)"
            );

            // Segment 3: Simpang Lapas Kerobokan (ORANGE - Left Turn Only from Mertanadi)
            calculateAndDisplayRoute(directionsService, map,
                "Jalan Mertanadi, Kerobokan Kelod, Bali", 
                "Lembaga Pemasyarakatan Kerobokan, Jalan Tangkuban Perahu, Bali", 
                "#FFA500", // ORANGE
                "Left Turn Only (Mertanadi)"
            );

            // Segment 4: Jalan Umalas 1 / Gang Nook (RED - CLOSED)
            // Visualizing the closed segment near the Petitenget intersection
            calculateAndDisplayRoute(directionsService, map,
                "Nook, Jalan Umalas 1, Bali", // Landmark inside the gang
                "Jalan Petitenget, Kerobokan Kelod, Bali", // Intersection
                "#FF0000", // RED
                "ROAD CLOSED (Gang Nook)"
            );

            // Segment 5: Jalan Raya Kerobokan (BLUE - One Way Northbound)
            calculateAndDisplayRoute(directionsService, map,
                "Lio Square, Kerobokan, Bali", // Simpang Petitenget Start
                "Simpang Semer, Kerobokan, Bali", // End Point North
                "#0000FF", // BLUE
                "One Way Northbound"
            );

            // Segment 6: Jalan Merta Agung (PURPLE - Right Turn Only)
            // Extended Origin to Gang Boom Baba for better visibility
            calculateAndDisplayRoute(directionsService, map,
                "Gang Boom Baba, Kerobokan, Bali", // Further West start point
                "Jalan Pengubengan Kauh, Kerobokan, Bali", // Must Turn Right (South)
                "#800080", // PURPLE
                "Right Turn Only (Merta Agung)"
            );

            // Segment 7: Jalan Serangan - Pengubengan Kauh (TEAL - One Way Southbound)
            calculateAndDisplayRoute(directionsService, map,
                "Simpang Semer, Kerobokan, Bali", // Start North
                "Simpang Pengubengan Kangin, Kerobokan Kelod, Bali", // End South
                "#008080", // TEAL
                "One Way Southbound"
            );

            // Segment 8: Jalan Mertanadi North (BROWN - Feeder Route)
            calculateAndDisplayRoute(directionsService, map,
                "Gusto Gelato & Caffe, Jalan Mertanadi, Bali", // North Landmark
                "Lembaga Pemasyarakatan Kerobokan, Jalan Tangkuban Perahu, Bali", // South End (Intersection)
                "#8B4513", // BROWN
                "Feeder Route (Jl. Mertanadi)"
            );

            // Segment 9: Simpang Tahura / Pura Karangasem (MAGENTA - Diversion)
            calculateAndDisplayRoute(directionsService, map,
                "Pura Karangasem, Jalan By Pass Ngurah Rai, Bali", // Origin
                "Underpass Ngurah Rai, Bali", // Destination (Diversion U-turn area)
                "#8B008B", // MAGENTA
                "Diversion to Underpass"
            );

            // Segment 10: Jalan Raya Kerobokan South (DARK TURQUOISE - One Way Southbound)
            calculateAndDisplayRoute(directionsService, map,
                "Lio Square, Kerobokan, Bali", // Start at Petitenget Intersection
                "Red Carpet Champagnebar, Jalan Kayu Aya, Bali", // End at Simpang Oberoi
                "#00CED1", // DARK TURQUOISE
                "One Way Southbound (to Oberoi)"
            );

            // Add Markers
            const infowindow = new google.maps.InfoWindow();

            const markerGusto = new google.maps.Marker({
                position: { lat: -8.675, lng: 115.166 }, // Approx Gusto Gelato
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 5,
                    fillColor: "#8B4513",
                    fillOpacity: 1,
                    strokeColor: "#FFFFFF",
                    strokeWeight: 2
                },
                title: "Gusto Gelato (Landmark)"
            });

            markerGusto.addListener("click", () => {
                infowindow.setContent("<strong>Gusto Gelato</strong><br>Landmark: Entering Feeder Route");
                infowindow.open(map, markerGusto);
            });

            const markerRestriction1 = new google.maps.Marker({
                position: { lat: -8.6785, lng: 115.163 }, // Approx coord for Intan Permai intersection
                map: map,
                label: "⛔",
                title: "RESTRICTION: Left Turn Only from Jl. Intan Permai"
            });
            
            const markerRestriction2 = new google.maps.Marker({
                position: { lat: -8.6781, lng: 115.166 }, // Approx coord for Mertanadi / Lapas intersection
                map: map,
                label: "⛔",
                title: "RESTRICTION: Left Turn Only from Jl. Mertanadi"
            });

            const markerRestriction3 = new google.maps.Marker({
                position: { lat: -8.6705, lng: 115.161 }, // Approx coord for Umalas 1 / Petitenget intersection
                map: map,
                label: "⛔",
                title: "ROAD CLOSED: Gang Nook Access"
            });
            
            const markerRestriction4 = new google.maps.Marker({
                position: { lat: -8.6655, lng: 115.160 }, // Approx Simpang Semer / Merta Agung
                map: map,
                label: "⛔",
                title: "RESTRICTION: No Left Turn to Semer"
            });

            const markerStartOneWay = new google.maps.Marker({
                position: { lat: -8.6745, lng: 115.162 }, // Approx Lio Square
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 6,
                    fillColor: "#0000FF",
                    fillOpacity: 1,
                    strokeColor: "#FFFFFF",
                    strokeWeight: 2
                },
                title: "Start ONE WAY North (Jl. Raya Kerobokan)"
            });


            markerRestriction1.addListener("click", () => {
                infowindow.setContent("<strong>Simpang Pengubengan Kauh</strong><br>⛔ NO Straight/Right Turn<br>✅ Left Turn Only");
                infowindow.open(map, markerRestriction1);
            });

            markerRestriction2.addListener("click", () => {
                infowindow.setContent("<strong>Simpang Lapas Kerobokan</strong><br>⛔ NO Right Turn (East)<br>✅ Left Turn Only (West)");
                infowindow.open(map, markerRestriction2);
            });

            markerRestriction3.addListener("click", () => {
                infowindow.setContent("<strong>Jalan Umalas 1 (Gang Nook)</strong><br>⛔ ROAD CLOSED (South Access)<br>Use Alternative Routes");
                infowindow.open(map, markerRestriction3);
            });

            markerRestriction4.addListener("click", () => {
                infowindow.setContent("<strong>Simpang Semer (Merta Agung)</strong><br>⛔ NO Left Turn to Semer<br>✅ Right Turn Only (to Pengubengan)");
                infowindow.open(map, markerRestriction4);
            });
        }

        function calculateAndDisplayRoute(directionsService, map, origin, destination, color, labelText) {
            directionsService.route(
                {
                    origin: origin,
                    destination: destination,
                    travelMode: 'DRIVING'
                },
                (response, status) => {
                    if (status === 'OK') {
                        const path = response.routes[0].overview_path;
                        
                        const lineSymbol = {
                            path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                            scale: 3.5, // Reduced to 50%
                            strokeColor: '#FFFFFF', // WHITE arrows
                            strokeOpacity: 1,
                            strokeWeight: 3 // Thicker border
                        };

                        new google.maps.Polyline({
                            path: path,
                            strokeColor: color,
                            strokeOpacity: 0.8,
                            strokeWeight: 10, // Slightly thicker line to hold the big arrows
                            icons: [{
                                icon: lineSymbol,
                                offset: '5%',
                                repeat: '10%' // More frequent
                            }],
                            map: map
                        });

                    } else {
                        console.error('Directions request failed due to ' + status);
                    }
                }
            );
        }
    </script>
</head>
<body>
    <div id="legend">
        <h3>Bali Traffic Update (14 Dec 2025)</h3>
        <div class="legend-item">
            <div class="symbol" style="background-color: #0000FF;"></div>
            <span>Jl. Gn. Tangkuban Perahu / Raya Kerobokan (One Way)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #008000;"></div>
            <span>Jl. Intan Permai Exit (Left Turn Only)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #FFA500;"></div>
            <span>Jl. Mertanadi Exit (Left Turn Only)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #FF0000;"></div>
            <span>Jl. Umalas 1 (ROAD CLOSED)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #800080;"></div>
            <span>Jl. Merta Agung (Right Turn Only)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #008080;"></div>
            <span>Jl. Pengubengan Kauh (One Way &darr;)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #8B4513;"></div>
            <span>Jl. Mertanadi (Feeder Route)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #8B008B;"></div>
            <span>Simpang Tahura (Diversion)</span>
        </div>
        <div class="legend-item">
            <div class="symbol" style="background-color: #00CED1;"></div>
            <span>Jl. Raya Kerobokan (One Way &darr;)</span>
        </div>
        <div class="legend-item">
            <span style="margin-right: 10px;">⛔</span>
            <span>No Right Turn / Straight / Entry</span>
        </div>
        <div style="font-size: 0.8em; color: #666; margin-top:5px;">
            Source: Dishub Badung / Polda Bali
        </div>
    </div>
    <div id="map"></div>
</body>
</html>